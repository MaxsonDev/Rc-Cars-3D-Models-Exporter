# Rc Cars 3D Models Exporter
**Rc Cars 3D Models Exporter** - это скрипт, написанный на языке Python. Скрипт предназначен для экспорта 3D моделей из файлов компьютерной игры ***"Rc Cars"*** в программу **Blender**. В странах СНГ игра более известна под названием ***"Недетские гонки"***.

# Как запустить скрипт?
### Для запуска скрипта нам понадобиться 3 вещи:
1. Файл игры формата `.sb`. В файлах этого формата хранится информация о всех объектах игры.
2. 3D редактор **Blender 2.80** версии и _выше_.
3. Скрипт **rccars_3d_models_exporter.py**.

### Чтобы запустить скрипт надо:
1. Запустить программу **Blender**. После запуска желательно удалить лишние объекты(куб, свет, камера), чтобы не мешали.
2. Открыть окно **Scripting** и открыть скрипт.
3. Найти скрипт **rccars_3d_models_exporter.py** в той папке, в которую вы его сохранили, и открыть.
4. В тексте скрипта найти переменную **FILE_PATH** и прописать в ней путь к `.sb` файлу. Пример написания пути к файлу в Windows и Linux(мб кто-то бдует запускать в Linux. LOL):
```
# Windows
FILE_PATH = "C:\\my\\path\\to\\file.sb"
# Linux
FILE_PATH = "/my/path/to/file.sb"
```
5. Запустить скрипт и подождать.
6. Готово!
# Как это работает?
> [!NOTE]
> Вся указанная ниже инфоромация строется на лично проведенном реверсинженеринге, анализе и изучении файлов. Как это должно конкретно работать известно только разработчикам.
> Я лишь делаю выводы из найденой информации и строю теории.

> [!NOTE]
> `^` - обозначает отображение чанков в `.sb` файле. Т.к. данные в `.sb` файле записаны _"зеркально"_, то, 
> если в `.sb` файле чанк записан как `^0092h`, то в оригинале это значение `9200h`. Как и HSEM - это MESH.
>
> `1111h и 0x1111` - h и 0x обозначают, что число записано в 16-й системе.

## Структура файла
Файл `.sb` является бинарным и имеет строгую побайтовую логику. Файл состоит из 2 блоков данных: - **заголовки файла и игровые объекты MOD**.
1. Блок **Заголовки файлов.**
Заголовки файлов инициализируют файл в игре. Состоят из сигнатуры(цифровой подписи `3801h(^0138h)`), текстовых заголовков, и инициализации MODs в файле. 
2. Блок **Игровые объекты MOD.**
**MOD** - это своего рода API игры. Состоит из **4 байт**. Бывают MOD из **8 байт**, но такие MOD в `.sb` файле не используются. Все MOD инициализируются в заголовках, и даже те, котрые могут быть не использоваться в файле. MOD инициализируются чанком `9A00h(^009Ah)` в заголовках. Вызываются чанком `9200h(^0092h)`. Список всех MOD можно увидеть в заголовках файла.

Структура записи данных имеет определенный шаблон: 
```
Чанк[1] + Указатель на конец данных[2] + Данные[3]
```
1. **Чанк** - группа данных, состоящая из **2 байт**. Каждый чанк уникален и имеет свою задачу. Чанк дает команду программе(exe-файл игры), что надо делать с данными, которые чанк хранит, как их обрабатывать. Пример: `7411h(^1174h)` - говорит программе, что в чанке хранятся вершины 3D модели, и программа, благодаря чанку, знает что это за данные, как устроены, как их обработать.
2. **Указатель на конец данных** - группа данных, состоящая из **4 байт**. Хранит адрес, на котором данные чанка заканчиваются. Некоторые чанки хранят внутри себя другие чанки, поэтому в данных могут оказаться другие чанки.
3. **Данные** - группа данных, состоящая из **x байт**. Может занимать любую длину байт.

## Известные чанки
Описание некоторых чанков, которые используются в скрипте и о работе которых известно.
Обозначение:<br/>**Length** - длина данных в байтах, которые хранит чанк.<br/>**Type** - тип данных.
### Общие чанки
**3801h(^0138h)**  - сигнатура файла`.sb`. Записывается в первые 2 байта файла. Является цифровой подписью. _Length_: **4 байта**. _Type_: **int**. Во всех файлах имеет значение 0x00060000.

**9200h(^0092h)**  - вызов MOD. _Length_: **4 байта**. _Type_: **int**. Но почему тип данных _int_, хотя MOD это текст? Технически, при вызове MODa, данные проверяются не как строка, к примеру, MESH, а как 16-ое число, получаемое из кодов, обозначающие эту строку в кодировке ASCII: `M(4D)E(45)S(53)H(48) == 0x4D455348.` Но проще конечно рассматривать как строку.

**9A00h(^009Ah)**  - инициализация MOD. _Length_: **4 байта**. _Type_: **int**. Причина того, что тип данных int такая же, как в чанке `9200h`.

**4803h(^0348h)** - хранит название объекта. _Length_: **длина строки + 1 нулевой байт**. _Type_: **string**. Является названием объекта.

### MESH чанки
Чанки используются только в MOD MESH.<br/><br/>
**7411h(^1174h)** - хранит данные о **всех** вершинах(vertex) 3D модели. Вершина - это 3 float кординаты на каждую ось пространста. 1 флоат == 4 байта.<br/>_Length_: **3 * 4 байт**. _Type_: **float**. Структура чанка:<br/>
`^1174h[2 байта] + указатель на конец данных[4 байта] + количество вершин[4 байта] + координаты вершин[3*4 байта] * число вершин`

**7413h(^1374h)** - хранит данные о **всех** координатах UV развертки 3D модели. Одна координата состоит из 2 флоат. 1 флоат == 4 байта.<br/>_Length_: **2 * 4 байт**. _Type_: **float**. Структуру чанка:<br/>
`^1374h[2 байта] + указатель на конец данных[4 байта] + количесвто координат[4 байта] + координаты вершин[2*4 байта] * число координат`

**3419h(^1934h)** - хранит данные об **1** полигоне(face) 3D модели. Полигон состоит из 3 int вершин. 1 int == 4 байта.<br/>_Length_: **3 * 4 байт**. _Type_: **int**. Структура чанка:<br/>
`^1934h[2 байта] + указатель на конец данных[4 байта] + количесвто вершин[4 байта] + номера вершин[3*4 байта] * количесвто вершин(3)`


